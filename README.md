# nbrew - Homebrew-style Wrapper for Nix

A simple bash wrapper that makes Nix behave like Homebrew, using `flake.nix` for declarative, reproducible environment configuration.

## Requirements

- Nix (with `nix-command` and `flakes` experimental features enabled)
- jq (for JSON parsing)

## Installation

```bash
# Copy nbrew to your PATH
cp nbrew ~/.local/bin/
chmod +x ~/.local/bin/nbrew

# Initialize global flake.nix
nbrew init
```

## Configuration

nbrew uses standard Nix flakes (`flake.nix`) with special markers to track packages:

```nix
# ~/.config/nix/flake.nix (or ./flake.nix for local projects)
{
  description = "nbrew managed packages";
  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";

  outputs = { self, nixpkgs }: {
    packages = forAllSystems (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        # [nbrew:packages]
        git = pkgs.git;
        ripgrep = pkgs.ripgrep;
        nodejs = pkgs.nodejs;
        # [/nbrew:packages]
      });

    devShells = forAllSystems (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        default = pkgs.mkShell {
          buildInputs = [
            # [nbrew:devShell]
            pkgs.cargo
            pkgs.rustc
            # [/nbrew:devShell]
          ];
        };
      });
  };
}
```

## Commands

### Basic Commands

| Command | Description |
|---------|-------------|
| `nbrew install <pkg>` | Install a package to nix profile |
| `nbrew uninstall <pkg>` | Uninstall a package |
| `nbrew add <pkg>` | Install and save to flake.nix |
| `nbrew search <query>` | Search for packages |
| `nbrew list` | List installed packages |
| `nbrew upgrade` | Upgrade all packages |

### Bundle Commands (for reproducibility)

| Command | Description |
|---------|-------------|
| `nbrew bundle` | Install all packages from flake.nix |
| `nbrew bundle dump` | Export installed packages to flake.nix |
| `nbrew bundle cleanup` | Remove packages not in flake.nix |
| `nbrew bundle check` | Verify all flake packages are installed |
| `nbrew bundle lock` | Update flake.lock |

### Environment Commands

| Command | Description |
|---------|-------------|
| `nbrew shell` | Enter dev shell from flake.nix |
| `nbrew gc` | Garbage collect old generations |
| `nbrew init` | Create global flake.nix (~/.config/nix/) |
| `nbrew init --local` | Create local flake.nix (./flake.nix) |

## Config Files

- **Global**: `~/.config/nix/flake.nix`
- **Local**: `./flake.nix` (takes precedence if exists)
- **Lock file**: `flake.lock` (auto-generated by Nix)

## Examples

```bash
# Install a package
nbrew install ripgrep

# Install and save to flake.nix
nbrew add nodejs

# Export all installed packages to flake.nix
nbrew bundle dump

# Install from flake.nix (on a new machine)
nbrew bundle

# Check if flake.nix matches installed packages
nbrew bundle check

# Remove packages not in flake.nix
nbrew bundle cleanup

# Enter dev shell with devShell packages
nbrew shell

# Update to latest nixpkgs
nbrew bundle lock
```

## Workflow

1. **Initial setup**: Run `nbrew init` to create a flake.nix
2. **Install packages**: Use `nbrew add <pkg>` to install and track packages
3. **Sync across machines**: Commit flake.nix and flake.lock to git, then run `nbrew bundle` on other machines
4. **Keep clean**: Run `nbrew bundle cleanup` to remove untracked packages

## Limitations

- Package names must be Nix package names (may differ from Homebrew)
- No cask equivalent for macOS GUI apps
- Requires Nix with experimental features enabled

## Environment Variables

- `NBREW_CONFIG_DIR`: Override config directory (default: `~/.config/nix`)
