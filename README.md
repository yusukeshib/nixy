# nixy - Homebrew-style Wrapper for Nix

A simple bash wrapper that makes Nix behave like Homebrew, using `flake.nix` for declarative, reproducible environment configuration.

## Requirements

- Nix (with `nix-command` and `flakes` experimental features enabled)

## Installation

```bash
curl -fsSL https://raw.githubusercontent.com/yusukeshib/nixy/main/install.sh | bash
```

Start using it right away:

```bash
nixy install ripgrep
```

### Manual Installation

```bash
cp nixy ~/.local/bin/
chmod +x ~/.local/bin/nixy
```

## Configuration

nixy uses standard Nix flakes (`flake.nix`) with special markers to track packages:

```nix
# ~/.config/nix/flake.nix (or ./flake.nix for local projects)
{
  description = "nixy managed packages";
  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";

  outputs = { self, nixpkgs }: {
    packages = forAllSystems (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        # [nixy:packages]
        git = pkgs.git;
        ripgrep = pkgs.ripgrep;
        nodejs = pkgs.nodejs;
        # [/nixy:packages]
      });

    devShells = forAllSystems (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        default = pkgs.mkShell {
          buildInputs = [
            # [nixy:devShell]
            pkgs.cargo
            pkgs.rustc
            # [/nixy:devShell]
          ];
        };
      });
  };
}
```

## Commands

### Basic Commands

| Command | Description |
|---------|-------------|
| `nixy init [dir]` | Initialize a local flake.nix (default: current dir) |
| `nixy install <pkg>` | Install a package (tracked in flake.nix) |
| `nixy install --file <path>` | Install from a local nix file |
| `nixy uninstall <pkg>` | Uninstall a package |
| `nixy search <query>` | Search for packages |
| `nixy list` | List installed packages |
| `nixy upgrade` | Upgrade all packages |

### Sync Commands

| Command | Description |
|---------|-------------|
| `nixy sync` | Sync installed packages with flake.nix |

### Environment Commands

| Command | Description |
|---------|-------------|
| `nixy shell` | Enter dev shell from flake.nix |
| `nixy gc` | Garbage collect old generations |

### Global Flag

All commands support `--global` (or `-g`) to use the global flake at `~/.config/nix/flake.nix` instead of searching for a local flake:

```bash
nixy install --global ripgrep   # Install to global flake
nixy list -g                    # List using global flake
```

## Flake Discovery

nixy automatically searches up the directory tree for `flake.nix`, similar to how git finds `.git`:

1. If a `flake.nix` exists in the current directory or any parent, it's used automatically
2. Use `--global` to explicitly use the global flake at `~/.config/nix/flake.nix`
3. If no local flake is found and `--global` is not specified, nixy fails with a helpful error

This allows per-project package management while still supporting a global configuration.

## Config Files

- **Global**: `~/.config/nix/flake.nix` (use with `--global`)
- **Local**: `./flake.nix` or parent directories (auto-discovered)
- **Local packages**: `~/.config/nix/packages/` (custom package definitions)
- **Lock file**: `flake.lock` (auto-generated by Nix)

## Local Package Format

You can install packages from custom nix files using `nixy install --file <path>`. The file should have this format:

```nix
{
  name = "my-package";
  inputs = { overlay-name.url = "github:user/repo"; };
  overlay = "overlay-name.overlays.default";
  packageExpr = "pkgs.my-package";
}
```

The file will be copied to `~/.config/nix/packages/` and integrated into the flake.

## Examples

```bash
# Initialize a local flake.nix in current directory
nixy init

# Install a package (uses local flake if found)
nixy install ripgrep

# Install to global flake
nixy install --global ripgrep

# Install from a local nix file
nixy install --file neovim.nix

# Upgrade all packages (updates nixpkgs too)
nixy upgrade

# Sync with flake.nix (on a new machine or after manual edits)
nixy sync

# Enter dev shell
nixy shell
```

## Workflow

1. **Initialize**: Run `nixy init` in your project directory (or use `--global` for system-wide)
2. **Install packages**: Use `nixy install <pkg>` (automatically tracked in flake.nix)
3. **Sync across machines**: Commit flake.nix and flake.lock to git, then run `nixy sync` on other machines

## Limitations

- Package names must be Nix package names (may differ from Homebrew)
- No cask equivalent for macOS GUI apps
- Requires Nix with experimental features enabled

## Environment Variables

- `NIXY_CONFIG_DIR`: Override config directory (default: `~/.config/nix`)
