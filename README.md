# nbrew - Homebrew-style Wrapper for Nix

A simple bash wrapper that makes Nix behave like Homebrew, using `flake.nix` for declarative, reproducible environment configuration.

## Requirements

- Nix (with `nix-command` and `flakes` experimental features enabled)
- jq (for JSON parsing)

## Installation

```bash
curl -fsSL https://raw.githubusercontent.com/yusukeshib/nbrew/main/install.sh | bash
```

Start using it right away:

```bash
nbrew install ripgrep
```

### Manual Installation

```bash
cp nbrew ~/.local/bin/
chmod +x ~/.local/bin/nbrew
```

## Configuration

nbrew uses standard Nix flakes (`flake.nix`) with special markers to track packages:

```nix
# ~/.config/nix/flake.nix (or ./flake.nix for local projects)
{
  description = "nbrew managed packages";
  inputs.nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";

  outputs = { self, nixpkgs }: {
    packages = forAllSystems (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        # [nbrew:packages]
        git = pkgs.git;
        ripgrep = pkgs.ripgrep;
        nodejs = pkgs.nodejs;
        # [/nbrew:packages]
      });

    devShells = forAllSystems (system:
      let pkgs = nixpkgs.legacyPackages.${system};
      in {
        default = pkgs.mkShell {
          buildInputs = [
            # [nbrew:devShell]
            pkgs.cargo
            pkgs.rustc
            # [/nbrew:devShell]
          ];
        };
      });
  };
}
```

## Commands

### Basic Commands

| Command | Description |
|---------|-------------|
| `nbrew install <pkg>` | Install a package (tracked in flake.nix) |
| `nbrew install --file <path>` | Install from a local nix file |
| `nbrew uninstall <pkg>` | Uninstall a package |
| `nbrew search <query>` | Search for packages |
| `nbrew list` | List installed packages |
| `nbrew upgrade` | Upgrade all packages |

### Sync Commands

| Command | Description |
|---------|-------------|
| `nbrew bundle` | Sync installed packages with flake.nix |

### Environment Commands

| Command | Description |
|---------|-------------|
| `nbrew shell` | Enter dev shell from flake.nix |
| `nbrew gc` | Garbage collect old generations |

## Config Files

- **Global**: `~/.config/nix/flake.nix`
- **Local**: `./flake.nix` (takes precedence if exists)
- **Local packages**: `~/.config/nix/packages/` (custom package definitions)
- **Lock file**: `flake.lock` (auto-generated by Nix)

## Local Package Format

You can install packages from custom nix files using `nbrew install --file <path>`. The file should have this format:

```nix
{
  name = "my-package";
  inputs = { overlay-name.url = "github:user/repo"; };
  overlay = "overlay-name.overlays.default";
  packageExpr = "pkgs.my-package";
}
```

The file will be copied to `~/.config/nix/packages/` and integrated into the flake.

## Examples

```bash
# Install a package
nbrew install ripgrep

# Install from a local nix file
nbrew install --file neovim.nix

# Upgrade all packages (updates nixpkgs too)
nbrew upgrade

# Sync with flake.nix (on a new machine or after manual edits)
nbrew bundle

# Enter dev shell
nbrew shell
```

## Workflow

1. **Install packages**: Use `nbrew install <pkg>` (automatically tracked in flake.nix)
2. **Sync across machines**: Commit flake.nix and flake.lock to git, then run `nbrew bundle` on other machines

## Limitations

- Package names must be Nix package names (may differ from Homebrew)
- No cask equivalent for macOS GUI apps
- Requires Nix with experimental features enabled

## Environment Variables

- `NBREW_CONFIG_DIR`: Override config directory (default: `~/.config/nix`)
