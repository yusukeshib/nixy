# nixy - Homebrew-style Wrapper for Nix

A simple bash wrapper that makes Nix behave like Homebrew, using `flake.nix` for declarative, reproducible package management.

## Requirements

- Nix (with `nix-command` and `flakes` experimental features enabled)

## Installation

```bash
curl -fsSL https://raw.githubusercontent.com/yusukeshib/nixy/main/install.sh | bash
```

### Manual Installation

```bash
cp nixy ~/.local/bin/
chmod +x ~/.local/bin/nixy
```

## Quick Start

```bash
# Initialize a flake.nix in your project
nixy init

# Install packages
nixy install ripgrep
nixy install nodejs

# List installed packages
nixy list
```

## Commands

### Basic Commands

| Command | Description |
|---------|-------------|
| `nixy init [dir]` | Initialize a local flake.nix (default: current dir) |
| `nixy install <pkg>` | Install a package (tracked in flake.nix) |
| `nixy install --file <path>` | Install from a local nix file |
| `nixy uninstall <pkg>` | Uninstall a package |
| `nixy search <query>` | Search for packages |
| `nixy list` | List installed packages |
| `nixy upgrade` | Upgrade all packages (updates flake.lock) |

### Sync Commands

| Command | Description |
|---------|-------------|
| `nixy sync` | Sync installed packages with flake.nix |

### Environment Commands

| Command | Description |
|---------|-------------|
| `nixy shell` | Enter dev shell from flake.nix |
| `nixy gc` | Garbage collect old generations |

### Global Flag

All commands support `--global` (or `-g`) to use the global flake at `~/.config/nix/flake.nix` instead of searching for a local flake:

```bash
nixy install --global ripgrep   # Install to global flake
nixy list -g                    # List using global flake
```

## Flake Discovery

nixy automatically searches up the directory tree for `flake.nix`, similar to how git finds `.git`:

1. If a `flake.nix` exists in the current directory or any parent, it's used automatically
2. Use `--global` to explicitly use the global flake at `~/.config/nix/flake.nix`
3. If no local flake is found and `--global` is not specified, nixy fails with a helpful error

This allows per-project package management while still supporting a global configuration.

## Generated Flake Structure

When you run `nixy init`, it creates a `flake.nix` with this structure:

```nix
{
  description = "nixy managed packages";

  inputs = {
    nixpkgs.url = "github:NixOS/nixpkgs/nixos-unstable";
    # [nixy:local-inputs]
    # [/nixy:local-inputs]
  };

  outputs = { self, nixpkgs }:
    let
      systems = [ "x86_64-linux" "aarch64-linux" "x86_64-darwin" "aarch64-darwin" ];
      forAllSystems = f: nixpkgs.lib.genAttrs systems (system: f system);
    in {
      packages = forAllSystems (system:
        let pkgs = nixpkgs.legacyPackages.${system};
        in {
          # [nixy:packages]
          ripgrep = pkgs.ripgrep;
          nodejs = pkgs.nodejs;
          # [/nixy:packages]
          # [nixy:local-packages]
          # [/nixy:local-packages]
        });

      devShells = forAllSystems (system:
        let pkgs = nixpkgs.legacyPackages.${system};
        in {
          default = pkgs.mkShell {
            buildInputs = [
              # [nixy:devShell]
              pkgs.ripgrep
              pkgs.nodejs
              # [/nixy:devShell]
            ];
          };
        });
    };
}
```

The `# [nixy:...]` markers are used by nixy to track and update packages.

## Config Files

| Path | Description |
|------|-------------|
| `./flake.nix` | Local project flake (auto-discovered in parent dirs) |
| `~/.config/nix/flake.nix` | Global flake (use with `--global`) |
| `~/.config/nix/packages/` | Custom package definitions |
| `flake.lock` | Lock file (auto-generated by Nix) |

## Local Package Format

You can install packages from custom nix files using `nixy install --file <path>`:

```nix
{
  name = "my-package";
  inputs = { overlay-name.url = "github:user/repo"; };
  overlay = "overlay-name.overlays.default";
  packageExpr = "pkgs.my-package";
}
```

The file will be copied to `~/.config/nix/packages/` and integrated into the flake.

## Workflow

### Per-Project Setup

```bash
cd my-project
nixy init                    # Create flake.nix
nixy install nodejs          # Add packages
git add flake.nix flake.lock # Track in git
```

### On Another Machine

```bash
git clone my-project
cd my-project
nixy sync                    # Install packages from flake.nix
```

### Global Setup

```bash
nixy init ~/.config/nix      # Create global flake
nixy install --global ripgrep
nixy install --global nodejs
```

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `NIXY_CONFIG_DIR` | Config directory | `~/.config/nix` |

## Limitations

- Package names must be Nix package names (may differ from Homebrew)
- No cask equivalent for macOS GUI apps
- Requires Nix with experimental features enabled

## Running Tests

```bash
./test_nixy.sh
```

## License

MIT
